---
- name: Detener actualizaciones automáticas en Windows 11
  hosts: windows
  gather_facts: no

  tasks:

    - name: Detener el servicio de Windows Update
      win_service:
        name: wuauserv
        state: stopped

    - name: Deshabilitar el servicio de Windows Update para que no se inicie automáticamente
      win_service:
        name: wuauserv
        start_mode: disabled

    - name: Verificar estado del servicio de Windows Update
      win_shell: |
        $svc = Get-Service wuauserv
        if ($svc.Status -eq "Stopped" -and $svc.StartType -eq "Disabled") {
            Write-Host "Actualizaciones automáticas DETENIDAS y DESHABILITADAS"
        } else {
            Write-Host "El servicio de actualizaciones aún está activo"
        }
      register: update_check

    - name: Mostrar resultado de la verificación
      debug:
        msg: "{{ update_check.stdout_lines }}"
