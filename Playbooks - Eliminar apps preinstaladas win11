---
- name: Eliminar bloatware innecesario en Windows 11 (entorno VM de pruebas)
  hosts: windows
  gather_facts: no
  tasks:

    - name: Definir apps a eliminar para el usuario actual
      ansible.windows.win_shell: |
        $apps = @(
          "*Microsoft.WindowsFeedbackHub*",
          "*Microsoft.XboxApp*",
          "*Microsoft.Xbox.TCUI*",
          "*Microsoft.XboxGamingOverlay*",
          "*Microsoft.XboxGameOverlay*",
          "*Microsoft.XboxIdentityProvider*",
          "*Microsoft.XboxSpeechToTextOverlay*",
          "*Microsoft.ZuneMusic*",
          "*Microsoft.ZuneVideo*",
          "*Microsoft.GamingApp*",
          "*MSTeams*",
          "*Microsoft.BingSearch*",
          "*Microsoft.Edge.GameAssist*",
          "*Microsoft.OutlookForWindows*",
          "*Microsoft.Todos*",
          "*Microsoft.WindowsTerminal*",
          "*Microsoft.WindowsSoundRecorder*",
          "*Microsoft.GetHelp*",
          "*Microsoft.Getstarted*",
          "*Microsoft.YourPhone*",
          "*Microsoft.WindowsMaps*",
          "*Microsoft.MicrosoftOfficeHub*",
          "*Microsoft.MicrosoftSolitaireCollection*",
          "*Microsoft.People*",
          "*Microsoft.SkypeApp*",
          "*Microsoft.BingNews*",
          "*Microsoft.BingWeather*",
          "*Microsoft.BingSports*",
          "*Microsoft.BingFinance*",
          "*Microsoft.Microsoft3DViewer*",
          "*Microsoft.MicrosoftWhiteboard*",
          "*Microsoft.PowerAutomateDesktop*",
          "*MicrosoftCorporationII.QuickAssist*",
          "*Microsoft.MicrosoftStickyNotes*",
          "*MicrosoftTeams*",
          "*Clipchamp.Clipchamp*",
          "*Microsoft.WindowsCamera*",
          "*SpotifyAB.SpotifyMusic*",
          "*Microsoft.MinecraftUWP*",
          "*Microsoft.Getstarted*",
          "*Microsoft.MixedReality*",
          "*Microsoft.Print3D*",
          "*Microsoft.Paint3D*"
        )
        foreach ($app in $apps) {
          Get-AppxPackage -Name $app -ErrorAction SilentlyContinue | Remove-AppxPackage -ErrorAction SilentlyContinue
        }

    - name: Eliminar apps provisionadas (para todos los usuarios nuevos)
      ansible.windows.win_shell: |
        $apps = @(
          "*Microsoft.WindowsFeedbackHub*",
          "*Microsoft.XboxApp*",
          "*Microsoft.Xbox.TCUI*",
          "*Microsoft.XboxGamingOverlay*",
          "*Microsoft.XboxGameOverlay*",
          "*Microsoft.XboxIdentityProvider*",
          "*Microsoft.XboxSpeechToTextOverlay*",
          "*Microsoft.ZuneMusic*",
          "*Microsoft.ZuneVideo*",
          "*Microsoft.WindowsCamera*",
          "*Microsoft.BingSearch*",
          "*Microsoft.Edge.GameAssist*",
          "*Microsoft.OutlookForWindows*",
          "*Microsoft.Todos*",
          "*Microsoft.WindowsTerminal*",
          "*Microsoft.GetHelp*",
          "*Microsoft.Getstarted*",
          "*Microsoft.YourPhone*",
          "*Microsoft.WindowsMaps*",
          "*Microsoft.MicrosoftOfficeHub*",
          "*Microsoft.MicrosoftSolitaireCollection*",
          "*Microsoft.People*",
          "*Microsoft.SkypeApp*",
          "*Microsoft.BingNews*",
          "*Microsoft.GamingApp*",
          "*MSTeams*",
          "*Microsoft.WindowsSoundRecorder*",
          "*Microsoft.BingWeather*",
          "*Microsoft.BingSports*",
          "*Microsoft.BingFinance*",
          "*Microsoft.Microsoft3DViewer*",
          "*Microsoft.MicrosoftWhiteboard*",
          "*Microsoft.PowerAutomateDesktop*",
          "*MicrosoftCorporationII.QuickAssist*",
          "*Microsoft.MicrosoftStickyNotes*",
          "*MicrosoftTeams*",
          "*Clipchamp.Clipchamp*",
          "*SpotifyAB.SpotifyMusic*",
          "*Microsoft.MinecraftUWP*",
          "*Microsoft.MixedReality*",
          "*Microsoft.Print3D*",
          "*Microsoft.Paint3D*"
        )
        foreach ($app in $apps) {
          Get-AppxProvisionedPackage -Online | Where-Object {$_.DisplayName -like $app} | Remove-AppxProvisionedPackage -Online -ErrorAction SilentlyContinue
        }

    - name: Eliminar apps para todos los usuarios existentes
      ansible.windows.win_shell: |
        $apps = @(
          "*Microsoft.WindowsFeedbackHub*",
          "*Microsoft.XboxApp*",
          "*Microsoft.Xbox.TCUI*",
          "*Microsoft.XboxGamingOverlay*",
          "*Microsoft.XboxGameOverlay*",
          "*Microsoft.XboxIdentityProvider*",
          "*Microsoft.XboxSpeechToTextOverlay*",
          "*Microsoft.ZuneMusic*",
          "*Microsoft.WindowsCamera*",
          "*Microsoft.ZuneVideo*",
          "*Microsoft.BingSearch*",
          "*Microsoft.Edge.GameAssist*",
          "*Microsoft.OutlookForWindows*",
          "*Microsoft.Todos*",
          "*Microsoft.WindowsTerminal*",
          "*Microsoft.GetHelp*",
          "*Microsoft.Getstarted*",
          "*Microsoft.YourPhone*",
          "*Microsoft.WindowsMaps*",
          "*Microsoft.MicrosoftOfficeHub*",
          "*Microsoft.MicrosoftSolitaireCollection*",
          "*Microsoft.People*",
          "*Microsoft.SkypeApp*",
          "*Microsoft.BingNews*",
          "*Microsoft.BingWeather*",
          "*Microsoft.GamingApp*",
          "*MSTeams*",
          "*Microsoft.WindowsSoundRecorder*",
          "*Microsoft.BingSports*",
          "*Microsoft.BingFinance*",
          "*Microsoft.Microsoft3DViewer*",
          "*Microsoft.MicrosoftWhiteboard*",
          "*Microsoft.PowerAutomateDesktop*",
          "*MicrosoftCorporationII.QuickAssist*",
          "*Microsoft.MicrosoftStickyNotes*",
          "*MicrosoftTeams*",
          "*Clipchamp.Clipchamp*",
          "*SpotifyAB.SpotifyMusic*",
          "*Microsoft.MinecraftUWP*",
          "*Microsoft.MixedReality*",
          "*Microsoft.Print3D*",
          "*Microsoft.Paint3D*"
        )
        foreach ($app in $apps) {
          Get-AppxPackage -AllUsers | Where-Object {$_.Name -like $app} | Remove-AppxPackage -AllUsers -ErrorAction SilentlyContinue
        }

    - name: Limpiar cach√© de paquetes
      ansible.windows.win_shell: |
        Start-Sleep -Seconds 3
        Write-Host "Limpieza completa de bloatware"
